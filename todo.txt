Possible bug. See comments in code.
